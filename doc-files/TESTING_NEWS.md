# Тестирование отображения новостей на главном экране

## Подготовка

### 1. Убедитесь что backend запущен

```bash
cd /Users/alejka1337/Desktop/buhassistant
docker-compose ps
```

Должны быть запущены:
- ✅ `buhassistant_postgres`
- ✅ `buhassistant_redis`
- ✅ `buhassistant_elasticsearch`
- ✅ `buhassistant_backend`
- ✅ `buhassistant_celery_worker`
- ✅ `buhassistant_celery_beat`

Если нет, запустите:
```bash
docker-compose up -d
```

### 2. Проверьте что есть новости в БД

```bash
curl -s http://localhost:8000/api/news/?limit=3 | python3 -m json.tool
```

Должен вернуть список новостей. Если новостей нет, запустите краулер:
```bash
curl -X POST http://localhost:8000/api/news/crawl/minfin
```

## Тестирование на iOS Simulator

### 1. Запустите backend
```bash
docker-compose up -d backend
```

### 2. Запустите Expo Dev Server
```bash
npx expo start
```

### 3. Откройте в iOS Simulator
Нажмите `i` в терминале или выберите "Run on iOS Simulator" в браузере

### 4. Проверьте главный экран
На главном экране должен появиться блок **"Актуальні новини"** с тремя новостями:
- Источник (зеленым цветом)
- Категория (бейдж справа)
- Заголовок (обрезанный до 60 символов)

### 5. Тестирование клика
При клике на новость должен открыться WebView с полной статьей

## Тестирование на реальном устройстве

### 1. Узнайте IP адрес вашего компьютера
```bash
# macOS
ifconfig | grep "inet " | grep -v 127.0.0.1

# Пример: 192.168.1.100
```

### 2. Обновите константу API_URL в `constants/api.ts`
```typescript
export const API_URL = __DEV__ 
  ? 'http://192.168.1.100:8000'  // Замените на ваш IP
  : 'https://your-production-api.com';
```

### 3. Убедитесь что backend доступен с вашего устройства
```bash
# На вашем телефоне откройте браузер и перейдите:
http://192.168.1.100:8000/api/docs
```

### 4. Запустите приложение через Expo Go
Отсканируйте QR код в Expo Dev Server

## Troubleshooting

### Новости не загружаются (показывается "Завантаження новин...")

**Проблема:** Backend недоступен или новостей нет в БД

**Решение:**
1. Проверьте что backend запущен: `docker-compose ps`
2. Проверьте логи backend: `docker-compose logs backend --tail=50`
3. Проверьте что есть новости: `curl http://localhost:8000/api/news/?limit=3`
4. Если новостей нет, запустите краулер: `curl -X POST http://localhost:8000/api/news/crawl/minfin`

### Ошибка "Network request failed"

**Проблема:** Приложение не может подключиться к backend

**Решение (iOS Simulator):**
- Используйте `localhost` в `constants/api.ts`

**Решение (Android Emulator):**
- Используйте `10.0.2.2` вместо `localhost`

**Решение (Реальное устройство):**
- Используйте IP адрес вашего компьютера (например, `192.168.1.100`)
- Убедитесь что телефон и компьютер в одной сети Wi-Fi
- Проверьте что порт 8000 открыт в файрволле

### Новости загружаются, но при клике ничего не происходит

**Проблема:** WebView не настроен или маршрут отсутствует

**Решение:**
1. Убедитесь что файл `app/webview.tsx` существует
2. Проверьте что в `app/_layout.tsx` есть маршрут для webview:
```tsx
<Stack.Screen name="webview" options={{ headerShown: false }} />
```

### Стили отображаются неправильно

**Проблема:** CSS не применился или кэш не обновился

**Решение:**
```bash
# Очистите кэш Expo
npx expo start -c
```

## Ожидаемый результат

### Главный экран должен показывать:

1. **Кнопки** (Консультація, Пошук)
2. **Найближчі звіти** (3 карточки)
3. **Актуальні новини** (3 карточки) с:
   - ✅ Источником (зеленый текст)
   - ✅ Категорией (серый бейдж)
   - ✅ Обрезанным заголовком (макс 60 символов)
   - ✅ Темным фоном (#2c3e50)
   - ✅ Закругленными углами

### При клике на новость:
- ✅ Открывается WebView с полной статьей
- ✅ Есть кнопка "Назад" для возврата

## Celery автоматизация

Celery Beat автоматически обновляет новости каждые 2 часа:
- Парсит новости с minfin.com.ua
- Фильтрует через OpenAI API
- Сохраняет только релевантные для бухгалтеров

Логи Celery:
```bash
docker-compose logs celery_worker --tail=50 --follow
docker-compose logs celery_beat --tail=50 --follow
```

## API Endpoints

- `GET /api/news/?limit=3` - получить последние 3 новости
- `GET /api/news/stats` - статистика новостей
- `POST /api/news/crawl/minfin` - ручной запуск краулера

## Следующие шаги

После успешного тестирования можно:
1. Добавить Pull-to-Refresh для обновления новостей
2. Добавить кнопку "Показать больше" для перехода к полному списку
3. Добавить фильтрацию по категориям
4. Добавить краулеры для других источников (tax.gov.ua, zakon.rada.gov.ua)

