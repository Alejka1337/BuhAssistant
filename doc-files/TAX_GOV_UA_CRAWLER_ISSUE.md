# Tax.gov.ua Crawler - –ü—Ä–æ–±–ª–µ–º–∞ —Å –¥–æ—Å—Ç—É–ø–æ–º (HTTP 403)

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –Ω–æ–≤–æ—Å—Ç–µ–π —Å `https://tax.gov.ua/media-tsentr/novini/` –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ **HTTP 403 Forbidden**.

## –ü—Ä–∏—á–∏–Ω–∞

–°–∞–π—Ç tax.gov.ua –∑–∞—â–∏—â–µ–Ω CDN (–≤–µ—Ä–æ—è—Ç–Ω–æ Akamai), –∫–æ—Ç–æ—Ä—ã–π –±–ª–æ–∫–∏—Ä—É–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –±–æ—Ç–æ–≤ –∏ —Å–∫—Ä–∏–ø—Ç–æ–≤.

### –ü—Ä–∏–∑–Ω–∞–∫–∏ –∑–∞—â–∏—Ç—ã:
- HTTP 403 –¥–∞–∂–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ User-Agent –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
- Server-timing header: `ak_p` (Akamai)
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞–∫ —á–µ—Ä–µ–∑ Python (aiohttp), —Ç–∞–∫ –∏ —á–µ—Ä–µ–∑ curl

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

‚úÖ **–ö–æ–¥ –∫—Ä–∞—É–ª–µ—Ä–∞ –≥–æ—Ç–æ–≤** –≤ `backend/app/services/tax_gov_ua_crawler.py`
‚úÖ **API endpoint —Å–æ–∑–¥–∞–Ω** `/api/news/crawl/tax-gov-ua`
‚ùå **–ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω** –∑–∞—â–∏—Ç–æ–π CDN

## –†–µ—à–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: Playwright/Selenium (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production)

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä –¥–ª—è –æ–±—Ö–æ–¥–∞ –∑–∞—â–∏—Ç—ã:

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Playwright

```bash
pip install playwright playwright-python
playwright install chromium
```

#### –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```python
from playwright.async_api import async_playwright

async def parse_tax_gov_ua_with_playwright(url: str):
    async with async_playwright() as p:
        browser = await p.chromium.launch(headless=True)
        page = await browser.new_page()
        
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º User-Agent
        await page.set_extra_http_headers({
            'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36'
        })
        
        # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
        await page.goto(url, wait_until='networkidle')
        
        # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π
        await page.wait_for_selector('.news__list')
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º HTML
        html = await page.content()
        
        await browser.close()
        return html
```

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- ‚úÖ –û–±—Ö–æ–¥–∏—Ç –∑–∞—â–∏—Ç—É CDN
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç JavaScript
- ‚úÖ –≠–º—É–ª–∏—Ä—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä

#### –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤ (RAM, CPU)
- ‚ùå –ú–µ–¥–ª–µ–Ω–Ω–µ–µ –æ–±—ã—á–Ω—ã—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚ùå –¢—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤ Docker

### –†–µ—à–µ–Ω–∏–µ 2: Proxy —Å–µ—Ä–≤–∏—Å

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–ª–∞—Ç–Ω—ã–π proxy —Å–µ—Ä–≤–∏—Å (ScraperAPI, Bright Data, Oxylabs):

```python
import aiohttp

async def parse_with_proxy():
    proxy_url = f"http://api.scraperapi.com/?api_key={API_KEY}&url={target_url}"
    async with aiohttp.ClientSession() as session:
        async with session.get(proxy_url) as response:
            return await response.text()
```

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ –†–æ—Ç–∞—Ü–∏—è IP –∞–¥—Ä–µ—Å–æ–≤
- ‚úÖ –û–±—Ö–æ–¥ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∑–∞—â–∏—Ç

#### –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
- ‚ùå –ü–ª–∞—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å (~$50-200/–º–µ—Å—è—Ü)
- ‚ùå –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

### –†–µ—à–µ–Ω–∏–µ 3: RSS Feed (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ —É tax.gov.ua RSS feed –¥–ª—è –Ω–æ–≤–æ—Å—Ç–µ–π:

```bash
curl https://tax.gov.ua/rss
curl https://tax.gov.ua/media-tsentr/novini/rss
```

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- ‚úÖ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

#### –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
- ‚ùå –ú–æ–∂–µ—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å
- ‚ùå –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤–æ—Å—Ç–µ–π

### –†–µ—à–µ–Ω–∏–µ 4: API –¥–æ—Å—Ç—É–ø (–õ—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ)

–°–≤—è–∑–∞—Ç—å—Å—è —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏ tax.gov.ua –∏ –∑–∞–ø—Ä–æ—Å–∏—Ç—å API –¥–æ—Å—Ç—É–ø –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–æ–≤–æ—Å—Ç–µ–π.

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è Production

### –í–∞—Ä–∏–∞–Ω—Ç A: Docker + Playwright

–û–±–Ω–æ–≤–∏—Ç—å `backend/Dockerfile`:

```dockerfile
FROM python:3.11-slim

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è Playwright
RUN apt-get update && apt-get install -y \
    wget \
    gnupg \
    ca-certificates \
    fonts-liberation \
    libasound2 \
    libatk-bridge2.0-0 \
    libatk1.0-0 \
    libc6 \
    libcairo2 \
    libcups2 \
    libdbus-1-3 \
    libexpat1 \
    libfontconfig1 \
    libgbm1 \
    libgcc1 \
    libglib2.0-0 \
    libgtk-3-0 \
    libnspr4 \
    libnss3 \
    libpango-1.0-0 \
    libpangocairo-1.0-0 \
    libstdc++6 \
    libx11-6 \
    libx11-xcb1 \
    libxcb1 \
    libxcomposite1 \
    libxcursor1 \
    libxdamage1 \
    libxext6 \
    libxfixes3 \
    libxi6 \
    libxrandr2 \
    libxrender1 \
    libxss1 \
    libxtst6 \
    lsb-release \
    xdg-utils \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
RUN pip install playwright
RUN playwright install chromium

COPY . .

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

### –í–∞—Ä–∏–∞–Ω—Ç B: –û—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞

–°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞:

```yaml
# docker-compose.yml
services:
  scraper:
    build: ./scraper
    container_name: buhassistant_scraper
    environment:
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - redis
```

## –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è MVP

–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

1. ‚úÖ **–û—Å—Ç–∞–≤–∏—Ç—å minfin.com.ua** - —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ
2. ‚è∏Ô∏è **–û—Ç–ª–æ–∂–∏—Ç—å tax.gov.ua** –¥–æ production —Ñ–∞–∑—ã
3. üìù **–î–æ–±–∞–≤–∏—Ç—å –≤ TODO** —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é Playwright –≤–µ—Ä—Å–∏–∏
4. üîÑ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏**:
   - `zakon.rada.gov.ua` - –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å–Ω–∞—è –±–∞–∑–∞
   - `buhgalter911.com.ua` - –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∏–π –ø–æ—Ä—Ç–∞–ª
   - `liga.net` - –Ω–æ–≤–æ—Å—Ç–Ω–æ–π –ø–æ—Ä—Ç–∞–ª

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –î–ü–°

–í–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

- üìß Email —Ä–∞—Å—Å—ã–ª–∫–∞ –î–ü–° (–µ—Å–ª–∏ –µ—Å—Ç—å)
- üì± Telegram –∫–∞–Ω–∞–ª –î–ü–° (–µ—Å–ª–∏ –µ—Å—Ç—å)
- üì° RSS feed (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
- üîó API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–∑–∞–ø—Ä–æ—Å–∏—Ç—å —É –î–ü–°)

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

–î–ª—è MVP:
1. –°–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö –±–µ–∑ –∑–∞—â–∏—Ç—ã (minfin.com.ua)
2. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
3. –û—Å—Ç–∞–≤–∏—Ç—å tax.gov.ua –Ω–∞ –±—É–¥—É—â–µ–µ —Å Playwright

–î–ª—è Production:
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Playwright –≤–µ—Ä—Å–∏—é –∫—Ä–∞—É–ª–µ—Ä–∞
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
3. –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –∏ error handling
4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞

## –°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏–π

| –†–µ—à–µ–Ω–∏–µ | –°—Ç–æ–∏–º–æ—Å—Ç—å | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ |
|---------|-----------|-----------|------------------|
| Playwright | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ | –°—Ä–µ–¥–Ω—è—è | 2-3 –¥–Ω—è |
| Proxy —Å–µ—Ä–≤–∏—Å | $50-200/–º–µ—Å | –ù–∏–∑–∫–∞—è | 1 –¥–µ–Ω—å |
| API –¥–æ—Å—Ç—É–ø | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ | –í—ã—Å–æ–∫–∞—è | 1-2 –º–µ—Å—è—Ü–∞ |
| RSS Feed | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ | –ù–∏–∑–∫–∞—è | 1 –¥–µ–Ω—å |

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (zakon.rada.gov.ua, buhgalter911.com.ua)
2. [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Playwright –≤–µ—Ä—Å–∏—é –¥–ª—è production
3. [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
4. [ ] –°–≤—è–∑–∞—Ç—å—Å—è —Å –î–ü–° –¥–ª—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ API –¥–æ—Å—Ç—É–ø–∞

