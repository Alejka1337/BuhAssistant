# Чеклист тестирования - Этап 3: Жалобы и блокировка

## Подготовка

- [ ] Backend запущен и доступен
- [ ] Применены все миграции
- [ ] Есть 2+ тестовых пользователя
- [ ] Есть тестовые топики и комментарии

## 1. Жалобы на контент

### Жалоба на топик
- [ ] Открыть чужой топик
- [ ] Увидеть кнопку меню (⋮) рядом с просмотрами
- [ ] Нажать меню → "Поскаржитися"
- [ ] Выбрать причину (например, "Спам або реклама")
- [ ] Добавить детали (опционально)
- [ ] Нажать "Надіслати"
- [ ] Увидеть Alert с подтверждением

### Жалоба на комментарий
- [ ] Открыть топик с комментариями от других пользователей
- [ ] Увидеть кнопку меню (⋮) под чужим комментарием
- [ ] Нажать меню → "Поскаржитися"
- [ ] Выбрать другую причину (например, "Образливий контент")
- [ ] Нажать "Надіслати" без деталей
- [ ] Увидеть Alert с подтверждением

### Проверка отсутствия меню на своём контенте
- [ ] Открыть свой топик - меню НЕ должно показываться
- [ ] Открыть свой комментарий - меню НЕ должно показываться
- [ ] Есть только кнопки "Редагувати" и "Видалити" (если это ваш контент)

## 2. Блокировка пользователей

### Блокировка из меню топика
- [ ] Открыть чужой топик
- [ ] Нажать меню (⋮) → "Заблокувати автора"
- [ ] Увидеть Alert с подтверждением
- [ ] Нажать "Заблокувати"
- [ ] Увидеть Alert "Користувача заблоковано"
- [ ] Происходит редирект назад на список топиков

### Блокировка из меню комментария
- [ ] Открыть топик
- [ ] Нажать меню (⋮) на чужом комментарии
- [ ] Выбрать "Заблокувати користувача"
- [ ] Подтвердить в Alert
- [ ] Увидеть подтверждение

## 3. Управление блокировками в профиле

### Просмотр заблокированных
- [ ] Перейти на вкладку "Профіль"
- [ ] Нажать "Заблоковані користувачі"
- [ ] Увидеть список с заблокированными пользователями
- [ ] Каждый пользователь показывает:
  - [ ] Иконку персоны
  - [ ] Полное имя или "Користувач"
  - [ ] Email
  - [ ] Кнопку "Розблокувати"

### Разблокировка пользователя
- [ ] В списке заблокированных нажать "Розблокувати"
- [ ] Увидеть Alert "Користувача розблоковано"
- [ ] Пользователь исчезает из списка

### Empty state
- [ ] Разблокировать всех пользователей
- [ ] Увидеть сообщение "Немає заблокованих користувачів"
- [ ] Увидеть иконку галочки (✓)

## 4. Edge cases

### Попытка действий без авторизации
- [ ] Разлогиниться
- [ ] Попытаться открыть топик
- [ ] Меню не должно показываться неавторизованным

### Множественные жалобы
- [ ] Создать 2-3 жалобы на разные топики/комментарии
- [ ] Все должны успешно отправиться
- [ ] Никаких дублирований или ошибок

### Повторная блокировка
- [ ] Заблокировать пользователя
- [ ] Разблокировать
- [ ] Заблокировать снова
- [ ] Должно работать без ошибок

## 5. API проверки (опционально)

### Проверить endpoints через curl/Postman

```bash
# Получить токен
TOKEN="your_access_token"

# Создать жалобу
curl -X POST https://api.eglavbuh.com.ua/api/reports \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "content_type": "thread",
    "content_id": 1,
    "reported_user_id": 2,
    "reason": "spam",
    "details": "Test complaint"
  }'

# Получить свои жалобы
curl https://api.eglavbuh.com.ua/api/reports/my \
  -H "Authorization: Bearer $TOKEN"

# Заблокировать пользователя
curl -X POST https://api.eglavbuh.com.ua/api/blocks \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"blocked_id": 2}'

# Получить список блокировок
curl https://api.eglavbuh.com.ua/api/blocks \
  -H "Authorization: Bearer $TOKEN"

# Разблокировать
curl -X DELETE https://api.eglavbuh.com.ua/api/blocks/2 \
  -H "Authorization: Bearer $TOKEN"
```

## 6. Проверка в базе данных (опционально)

```sql
-- Проверить таблицы созданы
SELECT * FROM content_reports LIMIT 5;
SELECT * FROM user_blocks LIMIT 5;

-- Подсчитать жалобы
SELECT status, COUNT(*) FROM content_reports GROUP BY status;

-- Подсчитать блокировки
SELECT COUNT(*) as total_blocks FROM user_blocks;
```

## Известные ограничения (ожидаемое поведение)

✅ Меню НЕ показывается на своём контенте - это правильно  
✅ Нельзя заблокировать себя - это правильно  
✅ После блокировки автора топика, контент пока ещё виден (фильтрация будет добавлена позже)

## Результат

После успешного прохождения всех пунктов:
- ✅ Жалобы работают
- ✅ Блокировка работает
- ✅ Управление блокировками работает
- ✅ Готово к деплою на production

---
**Статус:** Готово к тестированию  
**Дата:** 2 декабря 2025

