# AI-–ú–æ–¥–µ—Ä–∞—Ü–∏—è —Ñ–æ—Ä—É–º–∞ - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–∞—Ç–∞:** 6 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (—Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ OpenAI API key)

---

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ **–±–ª–æ–∫–∏—Ä—É—é—â–∞—è AI-–º–æ–¥–µ—Ä–∞—Ü–∏—è** –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Ñ–æ—Ä—É–º–∞ —á–µ—Ä–µ–∑ OpenAI Moderation API. –í—Å–µ –Ω–æ–≤—ã–µ —Ç–æ–ø–∏–∫–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º —Å–ø—ñ–ª—å–Ω–æ—Ç–∏ –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π.

---

## –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### Backend

1. **–ú–æ–¥–µ–ª—å `ModerationLog`** (`backend/app/models/moderation.py`)
   - –•—Ä–∞–Ω–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
   - –ü–æ–ª—è: content_type, content_id, user_id, decision, reason, ai_response, content_text, created_at

2. **–°–µ—Ä–≤–∏—Å –º–æ–¥–µ—Ä–∞—Ü–∏–∏** (`backend/app/services/moderation_service.py`)
   - `check_content_with_ai()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ OpenAI API
   - `check_forum_content()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Ñ–æ—Ä—É–º–∞ (–∑–∞–≥–æ–ª–æ–≤–æ–∫ + —Ç–µ–∫—Å—Ç)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥–µ–ª—å `omni-moderation-latest`
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–π —Å —É—Ä–æ–≤–Ω—è–º–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏

3. **Pydantic —Å—Ö–µ–º—ã** (`backend/app/schemas/moderation.py`)
   - `ModerationResultSchema` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
   - `ModerationLogCreate` - —Å–æ–∑–¥–∞–Ω–∏–µ –ª–æ–≥–∞
   - `ModerationError` - –æ—à–∏–±–∫–∞ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏

4. **API endpoints** (`backend/app/api/forum.py`)
   - `POST /api/forum/threads` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ç–æ–ø–∏–∫–∞
   - `POST /api/forum/posts` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 400 —Å –¥–µ—Ç–∞–ª—è–º–∏ –ø—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏

5. **Alembic –º–∏–≥—Ä–∞—Ü–∏—è**
   - –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `moderation_logs`
   - –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ `decision`, `created_at`

### Frontend

1. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç `ModerationErrorModal.tsx`**
   - –ö—Ä–∞—Å–∏–≤–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø—Ä–∏—á–∏–Ω–æ–π –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
   - –°–ø–∏—Å–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –Ω–∞ —É–∫—Ä–∞–∏–Ω—Å–∫–æ–º —è–∑—ã–∫–µ
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± AI-—Å–∏—Å—Ç–µ–º–µ
   - Responsive design (iOS + Web)

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –º–æ–¥–µ—Ä–∞—Ü–∏–∏**
   - `app/forum/create-thread.tsx` - –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–ø–∏–∫–æ–≤
   - `app/forum/create-thread.web.tsx` - web –≤–µ—Ä—Å–∏—è
   - `app/forum/thread/[id].tsx` - –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
   - `app/forum/thread/[id].web.tsx` - web –≤–µ—Ä—Å–∏—è

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ OpenAI API

### 1. –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á

1. –ó–∞–π—Ç–∏ –Ω–∞ [platform.openai.com](https://platform.openai.com/)
2. –í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç (–∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π)
3. –ü–µ—Ä–µ–π—Ç–∏ –≤ "API keys" ‚Üí "Create new secret key"
4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á (–æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!)

### 2. –î–æ–±–∞–≤–∏—Ç—å –≤ `.env` (backend)

```bash
# backend/.env
OPENAI_API_KEY=sk-proj-...
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ config
cd backend
docker-compose exec backend python -c "from app.core.config import settings; print(f'OpenAI API Key: {settings.OPENAI_API_KEY[:10]}...')"
```

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend

```bash
cd backend
docker-compose restart backend
```

---

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–æ–¥–µ—Ä–∞—Ü–∏—è

### –ü—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–≤–µ—Ä–∫–∏

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç** (—Ç–æ–ø–∏–∫ –∏–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π)
2. **Backend ‚Üí OpenAI Moderation API**
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å `omni-moderation-latest`
3. **OpenAI –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç**
   - `flagged: false` ‚Üí –∫–æ–Ω—Ç–µ–Ω—Ç **–æ–¥–æ–±—Ä–µ–Ω** ‚úÖ
   - `flagged: true` ‚Üí –∫–æ–Ω—Ç–µ–Ω—Ç **–æ—Ç–∫–ª–æ–Ω–µ–Ω** ‚õî
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ë–î** (`moderation_logs`)
5. **–û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é**
   - –û–¥–æ–±—Ä–µ–Ω–æ ‚Üí –∫–æ–Ω—Ç–µ–Ω—Ç –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è
   - –û—Ç–∫–ª–æ–Ω–µ–Ω–æ ‚Üí –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø—Ä–∏—á–∏–Ω–æ–π –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–π

OpenAI –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —É–∫—Ä–∞–∏–Ω—Å–∫–æ–º |
|-----------|------------------------|
| `sexual` | –°–µ–∫—Å—É–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç |
| `hate` | –ú–æ–≤–∞ –Ω–µ–Ω–∞–≤–∏—Å—Ç—ñ |
| `harassment` | –î–æ–º–∞–≥–∞–Ω–Ω—è |
| `self_harm` | –°–∞–º–æ–ø–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è |
| `sexual_minors` | –°–µ–∫—Å—É–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –∑ –Ω–µ–ø–æ–≤–Ω–æ–ª—ñ—Ç–Ω—ñ–º–∏ |
| `hate_threatening` | –ü–æ–≥—Ä–æ–∑–∏ –Ω–∞ —Ñ–æ–Ω—ñ –Ω–µ–Ω–∞–≤–∏—Å—Ç—ñ |
| `violence_graphic` | –ì—Ä–∞—Ñ—ñ—á–Ω–µ –Ω–∞—Å–∏–ª—å—Å—Ç–≤–æ |
| `violence` | –ù–∞—Å–∏–ª—å—Å—Ç–≤–æ |
| `illicit` | –ù–µ–∑–∞–∫–æ–Ω–Ω–∞ –¥—ñ—è–ª—å–Ω—ñ—Å—Ç—å |
| `illicit_violent` | –ù–∞—Å–∏–ª—å–Ω–∏—Ü—å–∫–∞ –Ω–µ–∑–∞–∫–æ–Ω–Ω–∞ –¥—ñ—è–ª—å–Ω—ñ—Å—Ç—å |

### –ü–æ—Ä–æ–≥–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏

- **–í—ã—Å–æ–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å** (‚â• 0.7) ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –ø—Ä–∏—á–∏–Ω–µ
- **–°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å** (‚â• 0.3) ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –ø—Ä–∏—á–∏–Ω–µ
- –ù–∏–∑–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (< 0.3) ‚Üí –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –¢–µ—Å—Ç —Å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º

```bash
# –í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç ‚Üí –§–æ—Ä—É–º ‚Üí –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É —Ç–µ–º—É
–ó–∞–≥–æ–ª–æ–≤–æ–∫: "–Ø–∫ —Ä–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –Ñ–°–í –¥–ª—è –§–û–ü?"
–ó–º—ñ—Å—Ç: "–î–æ–±—Ä–æ–≥–æ –¥–Ω—è! –ü—ñ–¥–∫–∞–∂—ñ—Ç—å, –±—É–¥—å –ª–∞—Å–∫–∞, —è–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –Ñ–°–í."

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –¢–æ–ø–∏–∫ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ
```

### 2. –¢–µ—Å—Ç —Å –Ω–∞—Ä—É—à–∞—é—â–∏–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º

```bash
# –í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç ‚Üí –§–æ—Ä—É–º ‚Üí –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É —Ç–µ–º—É
–ó–∞–≥–æ–ª–æ–≤–æ–∫: "–î–ï–®–ï–í–´–ï –ö–†–ï–î–ò–¢–´ –ë–ï–ó –ü–†–û–í–ï–†–û–ö!!!"
–ó–º—ñ—Å—Ç: "–î–µ–Ω—å–≥–∏ –≤ –¥–æ–ª–≥ –≤—Å–µ–º! –ü–µ—Ä–µ—Ö–æ–¥–∏ –ø–æ —Å—Å—ã–ª–∫–µ!"

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ‚õî –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –æ—à–∏–±–∫–æ–π
```

### 3. –¢–µ—Å—Ç —Å –ø—É—Å—Ç—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º

```bash
# –í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç ‚Üí –§–æ—Ä—É–º ‚Üí –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É —Ç–µ–º—É
–ó–∞–≥–æ–ª–æ–≤–æ–∫: ""
–ó–º—ñ—Å—Ç: ""

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ‚õî "–¢–µ–∫—Å—Ç –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ–º"
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –º–æ–¥–µ—Ä–∞—Ü–∏–∏

```sql
-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –ø—Ä–æ–≤–µ—Ä–æ–∫
SELECT 
    id, 
    content_type, 
    decision, 
    reason, 
    created_at 
FROM moderation_logs 
ORDER BY created_at DESC 
LIMIT 10;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–µ—à–µ–Ω–∏—è–º
SELECT 
    decision, 
    COUNT(*) as count 
FROM moderation_logs 
GROUP BY decision;
```

### 5. –†—É—á–Ω–æ–π —Ç–µ—Å—Ç —Å–µ—Ä–≤–∏—Å–∞

```python
# backend/app/services/moderation_service.py
cd backend
docker-compose exec backend python app/services/moderation_service.py
```

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ OpenAI API?

```python
# moderation_service.py, lines 105-112
except Exception as e:
    logger.error(f"‚ùå Error during moderation: {e}")
    # –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ API - –ù–ï –±–ª–æ–∫–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
    # (—á—Ç–æ–±—ã –Ω–µ –Ω–∞—Ä—É—à–∞—Ç—å —Ä–∞–±–æ—Ç—É —Ñ–æ—Ä—É–º–∞ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å OpenAI)
    return ModerationResult(
        approved=True,
        reason=f"Moderation API error (fallback to approve): {str(e)}"
    )
```

**–§–∏–ª–æ—Å–æ—Ñ–∏—è:** –ï—Å–ª–∏ OpenAI API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –∫–æ–Ω—Ç–µ–Ω—Ç **–æ–¥–æ–±—Ä—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**.  
–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ—Å–ø–µ—Ä–µ–±–æ–π–Ω—É—é —Ä–∞–±–æ—Ç—É —Ñ–æ—Ä—É–º–∞ –¥–∞–∂–µ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –º–æ–¥–µ—Ä–∞—Ü–∏–µ–π.

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –º–æ–¥–µ—Ä–∞—Ü–∏—é:

```bash
# backend/.env
# –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å OPENAI_API_KEY
# OPENAI_API_KEY=sk-proj-...
```

–°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–ª—é—á–∞ –∏ –±—É–¥–µ—Ç –æ–¥–æ–±—Ä—è—Ç—å –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç:

```python
# moderation_service.py, lines 49-51
if not settings.OPENAI_API_KEY:
    logger.warning("‚ö†Ô∏è OPENAI_API_KEY not configured, skipping moderation")
    return ModerationResult(approved=True, reason="Moderation disabled")
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ä–æ–≥–æ–≤ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏

–ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä–æ–≥–∏ –≤ `moderation_service.py`:

```python
# Lines 84-85
HIGH_THRESHOLD = 0.7  # –í—ã—Å–æ–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
MEDIUM_THRESHOLD = 0.3  # –°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
```

---

## –°—Ç–æ–∏–º–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è OpenAI

OpenAI Moderation API **–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π** –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π! üéâ

- –ù–µ—Ç –ª–∏–º–∏—Ç–æ–≤ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–µ —Ç–∞—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ GPT-3.5/GPT-4
- –ü–æ–¥—Ä–æ–±–Ω–µ–µ: [platform.openai.com/docs/guides/moderation](https://platform.openai.com/docs/guides/moderation)

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ moderation.py              # –ú–æ–¥–µ–ª—å ModerationLog
‚îÇ   ‚îú‚îÄ‚îÄ schemas/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ moderation.py              # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ moderation_service.py      # –°–µ—Ä–≤–∏—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îî‚îÄ‚îÄ forum.py                   # –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ endpoints (async)
‚îî‚îÄ‚îÄ migrations/
    ‚îî‚îÄ‚îÄ versions/
        ‚îî‚îÄ‚îÄ 2025_12_06_*_add_moderation_logs_table.py

frontend/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îî‚îÄ‚îÄ ModerationErrorModal.tsx       # –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—à–∏–±–∫–∏
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îî‚îÄ‚îÄ forum/
‚îÇ       ‚îú‚îÄ‚îÄ create-thread.tsx          # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–∞ (iOS)
‚îÇ       ‚îú‚îÄ‚îÄ create-thread.web.tsx      # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–∞ (Web)
‚îÇ       ‚îú‚îÄ‚îÄ thread/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ [id].tsx               # –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (iOS)
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ [id].web.tsx           # –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (Web)
```

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "OpenAI API error"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ `OPENAI_API_KEY` –≤ `.env`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∫–ª—é—á–∞ (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `sk-proj-`)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤ Docker
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend: `docker-compose restart backend`

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ frontend (console)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—à–∏–±–∫–∏:
   ```json
   {
     "detail": {
       "detail": "–í–∞—à –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –ø—Ä–æ–π—à–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—É –º–æ–¥–µ—Ä–∞—Ü—ñ—é",
       "reason": "–ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ—Ä—É—à—É—î –ø—Ä–∞–≤–∏–ª–∞",
       "suggestions": [...]
     }
   }
   ```
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç `ModerationErrorModal` –≤ —Ñ–∞–π–ª–∞—Ö

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–Ω—Ç–µ–Ω—Ç –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –¥–∞–∂–µ —Å –Ω–∞—Ä—É—à–µ–Ω–∏—è–º–∏

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend: `docker-compose logs -f backend`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `OPENAI_API_KEY` –Ω–∞—Å—Ç—Ä–æ–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:
   ```sql
   SELECT * FROM moderation_logs ORDER BY created_at DESC LIMIT 5;
   ```

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è OpenAI

- [Moderation API Guide](https://platform.openai.com/docs/guides/moderation)
- [API Reference](https://platform.openai.com/docs/api-reference/moderations)
- [Model Capabilities](https://platform.openai.com/docs/models/moderation)

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

```mermaid
graph TD
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç —Ç–æ–ø–∏–∫/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π] --> B{OpenAI API –¥–æ—Å—Ç—É–ø–µ–Ω?}
    B -->|–ù–µ—Ç| C[–û–¥–æ–±—Ä–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç]
    B -->|–î–∞| D[–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ OpenAI Moderation API]
    D --> E{–ö–æ–Ω—Ç–µ–Ω—Ç flagged?}
    E -->|–ù–µ—Ç| F[–û–¥–æ–±—Ä–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç]
    E -->|–î–∞| G[–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç]
    F --> H[–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î]
    G --> I[–ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø—Ä–∏—á–∏–Ω–æ–π]
    H --> J[–û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –Ω–∞ —Ñ–æ—Ä—É–º–µ]
    I --> K[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç]
```

---

## –°—Ç–∞—Ç—É—Å

‚úÖ **–≠—Ç–∞–ø 5 –∑–∞–≤–µ—Ä—à–µ–Ω!** –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ OpenAI API key.

**–°–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã:**
- –≠—Ç–∞–ø 6: –†–∞–∑–¥–µ–ª —Å–æ —Å—Ç–∞—Ç—å—è–º–∏ (—Ç–æ–ª—å–∫–æ –≤–µ–±)
- –≠—Ç–∞–ø 7: –†–µ–∫–≤–∏–∑–∏—Ç—ã –Ω–∞–ª–æ–≥–æ–≤—ã—Ö –æ—Ä–≥–∞–Ω–æ–≤ (—Ç–æ–ª—å–∫–æ –≤–µ–±)
- –≠—Ç–∞–ø 8: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –ø–ª–∞—Ç–µ–∂–µ–∫ (—Ç–æ–ª—å–∫–æ –≤–µ–±)

