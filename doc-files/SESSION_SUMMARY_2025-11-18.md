# –°–≤–æ–¥–∫–∞ —Å–µ—Å—Å–∏–∏: 18.11.2024

## üéØ –ì–ª–∞–≤–Ω–∞—è –∑–∞–¥–∞—á–∞
–ò—Å–ø—Ä–∞–≤–∏—Ç—å Google OAuth2 –Ω–∞ iOS

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ì–ª—É–±–æ–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ Google OAuth2 –Ω–∞ iOS
- –ò–∑—É—á–∏–ª–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É Google OAuth2 –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏ Authorization Code Flow vs Implicit Flow
- –í—ã—è–≤–∏–ª–∏ root cause –ø—Ä–æ–±–ª–µ–º—ã: **Web Client ID –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç custom URI schemes**

### 2. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### –ü–æ–ø—ã—Ç–∫–∞ 1: Native URI schemes
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `com.alejka1337.buhassistant.dev:/oauthredirect`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚ùå Google –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤ Web Client ID

#### –ü–æ–ø—ã—Ç–∫–∞ 2: Google reverse domain notation
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `com.googleusercontent.apps.CLIENT_ID:/oauthredirect`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚ùå Google —Ç—Ä–µ–±—É–µ—Ç http/https

#### –ü–æ–ø—ã—Ç–∫–∞ 3: iOS Client ID –¥–ª—è –æ–±–º–µ–Ω–∞ –∫–æ–¥–∞
- –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å iOS Client ID –Ω–∞–ø—Ä—è–º—É—é –¥–ª—è code exchange
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚ùå iOS Client ID –Ω–µ –∏–º–µ–µ—Ç client secret

### 3. Backend —É–ª—É—á—à–µ–Ω–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ `client_id` –≤ –∑–∞–ø—Ä–æ—Å–µ
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ Authorization Code Flow
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- ‚úÖ Backend —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª—é–±–æ–π redirect_uri –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞

### 4. Frontend —É–ª—É—á—à–µ–Ω–∏—è
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω Authorization Code Flow (–≤–º–µ—Å—Ç–æ Implicit Flow)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ `client_id` –Ω–∞ backend
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `app.json` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º URL scheme
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º iOS —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ

### 5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –°–æ–∑–¥–∞–Ω `GOOGLE_OAUTH_IOS_ISSUE.md` —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è (Firebase, WebView, Universal Links)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `buhassistant-mvp-development.plan.md`

### 6. –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
- ‚úÖ Google Sign In **–æ—Ç–∫–ª—é—á–µ–Ω** –≤ `app/login.tsx`
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å email/password –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –±—É–¥—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## üìä –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

### Backend:
1. `backend/app/core/google_auth.py`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `client_id` –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
   - –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ Web vs iOS Client ID
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

2. `backend/app/api/auth.py`
   - –û–±–Ω–æ–≤–ª–µ–Ω endpoint `/api/auth/google` –¥–ª—è –ø—Ä–∏–µ–º–∞ `client_id`
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥—è—â–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

3. `backend/app/schemas/google_auth.py`
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `client_id` –≤ `GoogleAuthRequest`

### Frontend:
1. `components/GoogleSignInButton.tsx`
   - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω Authorization Code Flow
   - –û–±–Ω–æ–≤–ª–µ–Ω redirect URI –Ω–∞ Google reverse domain notation
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ `client_id` –≤ callback

2. `utils/authService.ts`
   - –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `clientId` –≤ `googleAuth`
   - –û–±–Ω–æ–≤–ª–µ–Ω `redirect_uri` –≤ –∑–∞–ø—Ä–æ—Å–µ

3. `contexts/AuthContext.tsx`
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `googleLogin` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ `clientId`

4. `app/login.tsx`
   - **Google Sign In –∑–∞–∫–æ–º–µ–Ω—Ç–æ–≤–∞–Ω–æ** (–≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ)
   - –î–æ–±–∞–≤–ª–µ–Ω—ã TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

5. `app.json`
   - –û–±–Ω–æ–≤–ª–µ–Ω `scheme` –¥–ª—è iOS –Ω–∞ Google reverse domain notation

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
1. `doc-files/GOOGLE_OAUTH_IOS_ISSUE.md` ‚≠ê **–ù–û–í–´–ô**
   - –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
   - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
   - –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

2. `doc-files/SESSION_SUMMARY_2025-11-18.md` ‚≠ê **–ù–û–í–´–ô**
   - –≠—Ç–æ—Ç —Ñ–∞–π–ª

3. `buhassistant-mvp-development.plan.md`
   - –û–±–Ω–æ–≤–ª–µ–Ω —Å—Ç–∞—Ç—É—Å –≠—Ç–∞–ø–∞ 6 (–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—á–∞–Ω–∏—è –ø—Ä–æ Google OAuth2

## üîç –í—ã–≤–æ–¥—ã

### –ì–ª–∞–≤–Ω—ã–π –≤—ã–≤–æ–¥:
**Google OAuth2 –Ω–∞ iOS —Ç—Ä–µ–±—É–µ—Ç –ª–∏–±–æ Firebase, –ª–∏–±–æ Universal Links (Apple Developer Account)**

### –ü–æ—á–µ–º—É –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å "–ø—Ä–æ—Å—Ç–æ —Ç–∞–∫":
1. iOS Client ID –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è authorization code
2. –î–ª—è –æ–±–º–µ–Ω–∞ –∫–æ–¥–∞ –Ω—É–∂–µ–Ω Web Client ID —Å client secret
3. Web Client ID —Ç—Ä–µ–±—É–µ—Ç http/https redirect URIs
4. Custom URI schemes –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –¥–ª—è Web Client ID
5. **–≠—Ç–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Google OAuth2**

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- ‚úÖ Email/Password –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞
- ‚úÖ Backend –≥–æ—Ç–æ–≤ –¥–ª—è Google OAuth2 (–∂–¥–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π redirect URI)
- ‚úÖ Frontend –≥–æ—Ç–æ–≤ –¥–æ –º–æ–º–µ–Ω—Ç–∞ code exchange
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º iOS —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –±—É–¥—É—â–µ–µ

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ:
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å email/password –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é ‚úÖ **–ì–û–¢–û–í–û**
2. –î–æ–∂–¥–∞—Ç—å—Å—è Apple Developer Account

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω–æ (–ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è Apple Developer Account):
1. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å **Firebase Authentication** (—Å–∞–º–æ–µ –ø—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ)
2. –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å **Universal Links** (—Ç—Ä–µ–±—É–µ—Ç –¥–æ–º–µ–Ω)

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ:
1. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ —Å–ø–æ—Å–æ–±–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (Apple Sign In, Facebook, etc.)
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å 2FA
3. –î–æ–±–∞–≤–∏—Ç—å –±–∏–æ–º–µ—Ç—Ä–∏—é (Face ID / Touch ID)

## üìà –ü—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ–µ–∫—Ç–∞

### –ó–∞–≤–µ—Ä—à–µ–Ω–æ:
- ‚úÖ –≠—Ç–∞–ø 1-5: News, Search, Calendar
- ‚úÖ –≠—Ç–∞–ø 6: Email/Password –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ –≠—Ç–∞–ø 7: –ü—Ä–æ—Ñ–∏–ª—å –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ –≠—Ç–∞–ø 8: Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (backend + frontend)
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º iPhone

### –í –ø—Ä–æ—Ü–µ—Å—Å–µ:
- ‚è∏Ô∏è Google OAuth2 (–æ—Ç–ª–æ–∂–µ–Ω–æ –¥–æ Apple Developer Account)

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
2. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫ –¥–µ–ø–ª–æ—é –≤ App Store
3. –ü–æ–ª—É—á–∏—Ç—å Apple Developer Account
4. –†–µ—à–∏—Ç—å –≤–æ–ø—Ä–æ—Å —Å Google OAuth2

---

**–ò—Ç–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ –Ω–∞ Google OAuth2**: ~3 —á–∞—Å–∞  
**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 16  
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –í—ã—è–≤–ª–µ–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞, —Ç—Ä–µ–±—É—é—â–∞—è Firebase –∏–ª–∏ Universal Links

**–°—Ç–∞—Ç—É—Å**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –±–µ–∑ Google Sign In ‚úÖ

